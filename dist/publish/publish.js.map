{"version":3,"sources":["node_modules/_browser-pack@6.1.0@browser-pack/_prelude.js","src/game/game.ts","src/game/index.ts","src/game/scenes.ts","src/main.ts"],"names":[],"mappings":"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","file":"publish.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","///// <reference path=\"./dts/babylon.d.ts\"/>\r\n\r\n// import { VE_Objects, VE_Manager } from \"../veryengine/veryEngine\";\r\n\r\n// import { BabylonEngine, Time } from \"../veryengine/babylon\";\r\n\r\nexport class Game {\r\n    private _canvas: HTMLCanvasElement;\r\n    private _fps: HTMLElement;\r\n    private _table!: HTMLElement;\r\n    private _showFps: boolean = true;\r\n    private _engine!: BABYLON.Engine;\r\n    private _scene!: BABYLON.Scene;\r\n    // private _camera!: BABYLON.FreeCamera;\r\n\r\n    constructor(canvasElement: HTMLCanvasElement, fps: HTMLElement) {\r\n        this._canvas = canvasElement;\r\n        VR.BabylonEngine.Canvas = this._canvas;\r\n        this._fps = fps;\r\n        // this._engine = new BABYLON.Engine(this._canvas, true);\r\n        this._table = document.getElementById(\"VeryTable\")!;\r\n    }\r\n\r\n\t/**\r\n\t * 创建场景，并且启动\r\n\t */\r\n    createScene(path1: string, path2: string, datas: any): Game {\r\n        // TODO：场景管理\r\n\r\n        \r\n        // 1、模型可能是glTF或者babylonjs；\r\n        // 2、scene数据需要考虑\r\n        // Project:\r\n        //\tproject-settings;\r\n        //\tscenes:\r\n        //\t\tScene1:\r\n        //\t\t\tGameObjects\r\n        // 测试中\r\n        // \r\n\r\n\r\n\r\n        // 假设有运行中的engine，先停止，重新初始化\r\n        if (this._engine) {\r\n            // TODO: 对象中相关数据dispose\r\n            VR.VE_Manager.dispose();\r\n            // console.log(VE_Manager.projects.projects);\r\n            this._engine.dispose();\r\n        }\r\n        this._engine = new BABYLON.Engine(this._canvas, true);\r\n        VR.BabylonEngine.Engine = this._engine;\r\n        // Resize\r\n        let engine = this._engine;\r\n        window.addEventListener(\"resize\", function () {\r\n            engine.resize();\r\n        });\r\n\r\n        this._scene = new BABYLON.Scene(this._engine);\r\n        VR.BabylonEngine.Scene = this._scene;\r\n        VR.Time.start();\r\n\r\n        // TODO: 设定相机\r\n        var camera = new BABYLON.ArcRotateCamera(\"MainCamera\", 0, 0, 10, new BABYLON.Vector3(0, 0, 0), this._scene);\r\n        camera.setPosition(new BABYLON.Vector3(20, 200, 400));\r\n        camera.attachControl(this._canvas, true);\r\n        camera.lowerBetaLimit = 0.1;\r\n        camera.upperBetaLimit = (Math.PI / 2) * 0.99;\r\n        camera.lowerRadiusLimit = 150;\r\n\r\n        // let inputMap: { [key: string]: boolean } = {};\r\n\r\n        // TODO: 加载过度动画开\r\n        engine.hideLoadingUI();\r\n        // engine.displayLoadingUI();\r\n\r\n        // TODO: 加载scene.babylon场景文件，当前为默认\r\n        BABYLON.SceneLoader.Append(path1, path2, this._scene, function (scene) {\r\n            // do something with the scene\r\n            // 加载过度动画关\r\n            // engine.hideLoadingUI();\r\n\r\n            // Keyboard events\r\n            // var blue = scene.getMeshByName('blue')!;\r\n\r\n            // scene.actionManager = new BABYLON.ActionManager(scene);\r\n            // scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyDownTrigger, function (evt) {\r\n            // \tinputMap[evt.sourceEvent.key] = evt.sourceEvent.type == \"keydown\";\r\n            // }));\r\n            // scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyUpTrigger, function (evt) {\r\n            // \tinputMap[evt.sourceEvent.key] = evt.sourceEvent.type == \"keydown\";\r\n            // }));\r\n\r\n\r\n            // // Game/Render loop\r\n            // scene.onBeforeRenderObservable.add(() => {\r\n\r\n            // \tif (inputMap[\"w\"] || inputMap[\"ArrowUp\"]) {\r\n            // \t\tblue.position.z -= 100 * engine.getDeltaTime() / 1000;\r\n            // \t}\r\n            // \tif (inputMap[\"a\"] || inputMap[\"ArrowLeft\"]) {\r\n            // \t\tblue.position.x += 100 * engine.getDeltaTime() / 1000;\r\n            // \t}\r\n            // \tif (inputMap[\"s\"] || inputMap[\"ArrowDown\"]) {\r\n            // \t\tblue.position.z += 100 * engine.getDeltaTime() / 1000;\r\n            // \t}\r\n            // \tif (inputMap[\"d\"] || inputMap[\"ArrowRight\"]) {\r\n            // \t\tblue.position.x -= 100 * engine.getDeltaTime() / 1000;\r\n            // \t}\r\n            // })\r\n\r\n            // // sphere\r\n            // var sphere = scene.getMeshByName('sphere')!;\r\n            // sphere.actionManager = new BABYLON.ActionManager(scene);\r\n\r\n            // sphere.actionManager.registerAction(new BABYLON.SetValueAction(\r\n            // \t{ trigger: BABYLON.ActionManager.OnIntersectionEnterTrigger, parameter: blue },\r\n            // \tsphere, \"scaling\", new BABYLON.Vector3(2, 2, 2)));\r\n\r\n            // sphere.actionManager.registerAction(new BABYLON.SetValueAction(\r\n            // \t{ trigger: BABYLON.ActionManager.OnIntersectionExitTrigger, parameter: blue }\r\n            // \t, sphere, \"scaling\", new BABYLON.Vector3(1, 1, 1)));\r\n\r\n            //     let p1 = scene.getMeshByName('Object023');\r\n            //     scene.getMeshByName('Object022')!.setParent(p1);\r\n            //     scene.getMeshByName('Object035')!.setParent(p1);\r\n            //     let p2 = scene.getMeshByName('Object042');\r\n            //     scene.getMeshByName('Object040')!.setParent(p2);\r\n            //     scene.getMeshByName('Object043')!.setParent(p2);\r\n            //     let p3 = scene.getMeshByName('Object047');\r\n            //     scene.getMeshByName('Object044')!.setParent(p3);\r\n            //     scene.getMeshByName('Object045')!.setParent(p3);\r\n            //     let p4 = scene.getMeshByName('Object051');\r\n            //     scene.getMeshByName('Object048')!.setParent(p4);\r\n            //     scene.getMeshByName('Object049')!.setParent(p4);\r\n            //     p1!.name = \"叶片1\";\r\n            //     p2!.name = \"叶片2\";\r\n            //     p3!.name = \"叶片3\";\r\n            //     p4!.name = \"叶片4\";\r\n\r\n            // TODO: 表格加载测试，应在所有模型加载完以后再初始化引擎\r\n            // console.log(hot1.getData());\r\n            let entrance: VR.VeryEngine = new VR.VeryEngine();\r\n            let projectName = \"测试项目\";\r\n            console.log(datas);\r\n            // console.log(`空行数：${hot1.countEmptyRows()}`);\r\n            try {\r\n                entrance.init(datas, projectName);\r\n            } catch (e) { // TODO: 可能会影响效率\r\n                console.error(e);\r\n            }\r\n\r\n            \r\n\r\n            let objects: VR.VE_Objects = VR.VE_Manager.objects(projectName);\r\n            // 全局渲染帧循环\r\n            scene.onBeforeRenderObservable.add(() => {\r\n                // 添加帧函数\r\n                // VR.Time._sum();\r\n\r\n                // 触发响应循环\r\n                for (let i: number = 0; i < objects.count; i++) {\r\n                    let objectID: string = objects.getObjectID(i);\r\n                    objects.getVeryObject(objectID).update();\r\n                }\r\n\r\n            });\r\n\r\n            scene.onKeyboardObservable.add(kbInfo => {\r\n            \tif (kbInfo.type === BABYLON.KeyboardEventTypes.KEYDOWN) {\r\n            \t\tconsole.log(kbInfo.event.key);\r\n            \t}\r\n            });\r\n\r\n\r\n\r\n\r\n        }, null, (scene, message, exception) => {\r\n            console.error(message);\r\n            console.error(exception);\r\n        });\r\n\r\n        this._engine.runRenderLoop(() => {\r\n            // if (this._canvas.width !== this._canvas.clientWidth) {\r\n            //     this._engine.resize();\r\n            // }\r\n\r\n            if (this._scene) {\r\n                if (this._scene.activeCamera) {\r\n                    this._scene.render();\r\n                }\r\n            }\r\n\r\n            // if (this._showFps) {\r\n            // \tthis.updateFpsPos();\r\n            // }\r\n\r\n\r\n        });\r\n        // return this;\r\n\r\n\r\n        // this.expandControl();\r\n\r\n\r\n        // const lightPos = new BABYLON.Vector3(0, 1, 0);\r\n        // new BABYLON.HemisphericLight('hemlight', lightPos, this._scene);\r\n\r\n        // const sphereOpts = { segments: 16, diameter: 1 };\r\n        // let sphere = BABYLON.MeshBuilder.CreateSphere(\r\n        // \t'mainsphere',\r\n        // \tsphereOpts,\r\n        // \tthis._scene\r\n        // );\r\n        // sphere.position.y = 1;\r\n\r\n        // const groundOpts = { width: 6, height: 6, subdivisions: 2 };\r\n        // BABYLON.MeshBuilder.CreateGround('mainground', groundOpts, this._scene);\r\n\r\n\r\n\r\n\r\n        return this;\r\n    }\r\n\r\n\t/**\r\n\t * 启动渲染循环；\r\n\t */\r\n    animate(): Game {\r\n        this._engine.runRenderLoop(() => {\r\n            // if (this._canvas.width !== this._canvas.clientWidth) {\r\n            //     this._engine.resize();\r\n            // }\r\n\r\n            if (this._scene) {\r\n                this._scene.render();\r\n            }\r\n\r\n            if (this._showFps) {\r\n                this.updateFpsPos();\r\n            }\r\n\r\n\r\n        });\r\n        return this;\r\n    }\r\n\r\n\t/**\r\n\t * 属性编辑器UI界面控制；\r\n\t */\r\n    toggleDebug(): Game {\r\n        if (this._engine) {\r\n            // Always showing the debug layer, because you can close it by itself\r\n            var scene = this._engine.scenes[0];\r\n            if (scene.debugLayer.isVisible()) {\r\n                scene.debugLayer.hide();\r\n            }\r\n            else {\r\n                // 此处修改了babylon.d.ts文件\r\n                scene.debugLayer.show({ embedMode: true });\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n\t/**\r\n\t * 更新fps显示及显示位置\r\n\t */\r\n    updateFpsPos(): void {\r\n        if (this._fps) {\r\n            // this._fps.style.right = document.body.clientWidth - (this._table.clientWidth + this._canvas.clientWidth) + \"px\";\r\n\r\n            this._fps.innerHTML = this._engine.getFps().toFixed() + \" fps\";\r\n        }\r\n    }\r\n}\r\n","export * from './game';\r\nexport * from './scenes';","export class Scenes {\r\n\r\n\r\n\r\n  public constructor() {\r\n    // connect to server\r\n    // load project data\r\n    // analysis data\r\n    // load original model\r\n    // load scene object from original model\r\n    \r\n  }\r\n\r\n\r\n\r\n\r\n}","import { Game } from \"./game\";\r\n\r\nlet game!: Game;\r\nlet initFlag: boolean = false;\r\nlet dataLoaded: boolean = false;\r\nlet dataLoaded2: boolean = false;\r\n\r\nlet path1: string = \"\";\r\nlet path2: string = \"\";\r\nlet datas: any;\r\n\r\n/**\r\n * 初始化入口；\r\n */\r\nfunction initGame(): void {\r\n    let canvas = <HTMLCanvasElement>document.getElementById(\"renderCanvas\");\r\n    let fpsLabel = document.getElementById(\"fpsLabel\");\r\n    if (canvas !== null && fpsLabel !== null) {\r\n        game = new Game(canvas, fpsLabel);\r\n        game.createScene(path1, path2, datas).animate();  // 链式调用\r\n    }\r\n}\r\n\r\nfunction runBtn(): void {\r\n    if (game) {\r\n        game.createScene(path1, path2, datas).animate();\r\n    }\r\n}\r\n\r\nfunction toggleDebug(): void {\r\n    if (game) {\r\n        game.toggleDebug();\r\n    }\r\n}\r\n\r\nfunction init(): void {\r\n    // 等待表格数据加载完成\r\n    if (dataLoaded && dataLoaded2) {\r\n        initGame();\r\n    } else {\r\n        setTimeout(init, 500);\r\n    }\r\n}\r\n\r\n\r\nfunction loadScene(): void {\r\n\r\n    var projectID = window.location.pathname.substring(9);\r\n    var sceneData: any;\r\n    axios.post('/api/getScenes', { projectID: projectID })\r\n        .then(response => {\r\n            var data = response.data;\r\n            if (data.code === \"0000\") {\r\n                let lastScene: number = data.data.last;\r\n                sceneData = data.data.scenes[lastScene];\r\n                console.log(sceneData);\r\n                document.title = sceneData.name + \" | 发布项目\";\r\n                path1 = sceneData.path1;\r\n                path2 = sceneData.path2;\r\n                console.log(\"path1: \" + sceneData.path1);\r\n                console.log(\"path2: \" + sceneData.path2);\r\n                dataLoaded2 = true;\r\n            } else {\r\n                console.error(data.message);\r\n            }\r\n            // ep.emit('settings', response.data);\r\n        })\r\n        .catch(\r\n            error => {\r\n                console.error(error);\r\n            }\r\n\r\n        );\r\n}\r\n\r\nloadScene();\r\n\r\n\r\nfunction loadData(): void {\r\n    // 获取表格数据\r\n    var path = window.location.href;\r\n    var paramsData: any = {};\r\n    paramsData[\"name\"] = \"新表格.table\";\r\n    axios\r\n        .get(\"/api/table/acquire\", {\r\n            params: paramsData,\r\n        })\r\n        .then(function (response) {\r\n            let data = response.data;\r\n            // console.log(data);\r\n            if (data.code === \"0000\") {\r\n                // 先将json转化为字符串\r\n                let tempData = JSON.stringify(data.data);\r\n                // 对字符串再进行反转义\r\n                tempData = escape2Html(tempData);\r\n                // 转化为json后，赋值给表格\r\n                // hot1.loadData(JSON.parse(tempData).table);\r\n                // console.log(JSON.parse(tempData).table);\r\n                datas = JSON.parse(tempData).table;\r\n                dataLoaded = true;\r\n            } else {\r\n                // Do nothing\r\n                console.log(\"load not right: \" + data.message);\r\n            }\r\n        })\r\n        .catch(function (error) {\r\n            console.log(\"load error: \" + error);\r\n        });\r\n}\r\n\r\nloadData();\r\n\r\n//HTML标签转义（< -> &lt;）\r\nfunction html2Escape(sHtml: any) {\r\n    var temp: any = document.createElement(\"div\");\r\n    temp.textContent != null\r\n        ? (temp.textContent = sHtml)\r\n        : (temp.innerText = sHtml);\r\n    var output = temp.innerHTML;\r\n    temp = null;\r\n    return output;\r\n}\r\n\r\n//HTML标签反转义（&lt; -> <）\r\nfunction escape2Html(str: any) {\r\n    var temp: any = document.createElement(\"div\");\r\n    temp.innerHTML = str;\r\n    var output = temp.innerText || temp.textContent;\r\n    temp = null;\r\n    return output;\r\n}\r\n\r\n// 关联按钮\r\n// document.getElementById(\"runButton\")!.addEventListener(\"click\", runBtn);\r\n\r\n// // 关联按钮\r\n// document.getElementById(\"debugButton\")!.addEventListener(\"click\", toggleDebug);\r\n\r\n// 启动引擎\r\n// 第一次启动时，先异步加载数据后再初始化，后期可以直接点击按钮进行加载；\r\ninit();\r\n// loadData2()\r\n//   .then(function (hot: HandTable) {\r\n//     console.log(hot.getData());\r\n//   }\r\n//   );\r\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9fYnJvd3Nlci1wYWNrQDYuMS4wQGJyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInNyYy9nYW1lL2dhbWUudHMiLCJzcmMvZ2FtZS9pbmRleC50cyIsInNyYy9nYW1lL3NjZW5lcy50cyIsInNyYy9tYWluLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztBQ0FBLDRDQUE0Qzs7O0FBRTVDLHFFQUFxRTtBQUVyRSwrREFBK0Q7QUFFL0Q7SUFPSSx3Q0FBd0M7SUFFeEMsY0FBWSxhQUFnQyxFQUFFLEdBQWdCO1FBTHRELGFBQVEsR0FBWSxJQUFJLENBQUM7UUFNN0IsSUFBSSxDQUFDLE9BQU8sR0FBRyxhQUFhLENBQUM7UUFDN0IsRUFBRSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUN2QyxJQUFJLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQztRQUNoQix5REFBeUQ7UUFDekQsSUFBSSxDQUFDLE1BQU0sR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBRSxDQUFDO0lBQ3hELENBQUM7SUFFSjs7T0FFRztJQUNBLDBCQUFXLEdBQVgsVUFBWSxLQUFhLEVBQUUsS0FBYSxFQUFFLEtBQVU7UUFDaEQsWUFBWTtRQURoQixpQkFvTUM7UUFoTUcsMEJBQTBCO1FBQzFCLGdCQUFnQjtRQUNoQixXQUFXO1FBQ1gsb0JBQW9CO1FBQ3BCLFVBQVU7UUFDVixXQUFXO1FBQ1gsZ0JBQWdCO1FBQ2hCLE1BQU07UUFDTixHQUFHO1FBSUgsMEJBQTBCO1FBQzFCLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNkLHVCQUF1QjtZQUN2QixFQUFFLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ3hCLDZDQUE2QztZQUM3QyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO1NBQzFCO1FBQ0QsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLE9BQU8sQ0FBQyxNQUFNLENB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QUFHLElBQUksQ0FBQztJQUNaLE9BQU8sTUFBTSxDQUFDO0FBQ2xCLENBQUM7QUFFRCxzQkFBc0I7QUFDdEIsU0FBUyxXQUFXLENBQUMsR0FBUTtJQUN6QixJQUFJLElBQUksR0FBUSxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzlDLElBQUksQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDO0lBQ3JCLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQztJQUNoRCxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ1osT0FBTyxNQUFNLENBQUM7QUFDbEIsQ0FBQztBQUVELE9BQU87QUFDUCwyRUFBMkU7QUFFM0UsVUFBVTtBQUNWLGtGQUFrRjtBQUVsRixPQUFPO0FBQ1Asc0NBQXNDO0FBQ3RDLElBQUksRUFBRSxDQUFDO0FBQ1AsY0FBYztBQUNkLHNDQUFzQztBQUN0QyxrQ0FBa0M7QUFDbEMsTUFBTTtBQUNOLE9BQU8iLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCIvLy8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuL2R0cy9iYWJ5bG9uLmQudHNcIi8+XHJcblxyXG4vLyBpbXBvcnQgeyBWRV9PYmplY3RzLCBWRV9NYW5hZ2VyIH0gZnJvbSBcIi4uL3ZlcnllbmdpbmUvdmVyeUVuZ2luZVwiO1xyXG5cclxuLy8gaW1wb3J0IHsgQmFieWxvbkVuZ2luZSwgVGltZSB9IGZyb20gXCIuLi92ZXJ5ZW5naW5lL2JhYnlsb25cIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBHYW1lIHtcclxuICAgIHByaXZhdGUgX2NhbnZhczogSFRNTENhbnZhc0VsZW1lbnQ7XHJcbiAgICBwcml2YXRlIF9mcHM6IEhUTUxFbGVtZW50O1xyXG4gICAgcHJpdmF0ZSBfdGFibGUhOiBIVE1MRWxlbWVudDtcclxuICAgIHByaXZhdGUgX3Nob3dGcHM6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgcHJpdmF0ZSBfZW5naW5lITogQkFCWUxPTi5FbmdpbmU7XHJcbiAgICBwcml2YXRlIF9zY2VuZSE6IEJBQllMT04uU2NlbmU7XHJcbiAgICAvLyBwcml2YXRlIF9jYW1lcmEhOiBCQUJZTE9OLkZyZWVDYW1lcmE7XHJcblxyXG4gICAgY29uc3RydWN0b3IoY2FudmFzRWxlbWVudDogSFRNTENhbnZhc0VsZW1lbnQsIGZwczogSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLl9jYW52YXMgPSBjYW52YXNFbGVtZW50O1xyXG4gICAgICAgIFZSLkJhYnlsb25FbmdpbmUuQ2FudmFzID0gdGhpcy5fY2FudmFzO1xyXG4gICAgICAgIHRoaXMuX2ZwcyA9IGZwcztcclxuICAgICAgICAvLyB0aGlzLl9lbmdpbmUgPSBuZXcgQkFCWUxPTi5FbmdpbmUodGhpcy5fY2FudmFzLCB0cnVlKTtcclxuICAgICAgICB0aGlzLl90YWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiVmVyeVRhYmxlXCIpITtcclxuICAgIH1cclxuXHJcblx0LyoqXHJcblx0ICog5Yib5bu65Zy65pmv77yM5bm25LiU5ZCv5YqoXHJcblx0ICovXHJcbiAgICBjcmVhdGVTY2VuZShwYXRoMTogc3RyaW5nLCBwYXRoMjogc3RyaW5nLCBkYXRhczogYW55KTogR2FtZSB7XHJcbiAgICAgICAgLy8gVE9ET++8muWcuuaZr+euoeeQhlxyXG5cclxuICAgICAgICBcclxuICAgICAgICAvLyAx44CB5qih5Z6L5Y+v6IO95pivZ2xURuaIluiAhWJhYnlsb25qc++8m1xyXG4gICAgICAgIC8vIDLjgIFzY2VuZeaVsOaNrumcgOimgeiAg+iZkVxyXG4gICAgICAgIC8vIFByb2plY3Q6XHJcbiAgICAgICAgLy9cdHByb2plY3Qtc2V0dGluZ3M7XHJcbiAgICAgICAgLy9cdHNjZW5lczpcclxuICAgICAgICAvL1x0XHRTY2VuZTE6XHJcbiAgICAgICAgLy9cdFx0XHRHYW1lT2JqZWN0c1xyXG4gICAgICAgIC8vIOa1i+ivleS4rVxyXG4gICAgICAgIC8vIFxyXG5cclxuXHJcblxyXG4gICAgICAgIC8vIOWBh+iuvuaciei/kOihjOS4reeahGVuZ2luZe+8jOWFiOWBnOatou+8jOmHjeaWsOWIneWni+WMllxyXG4gICAgICAgIGlmICh0aGlzLl9lbmdpbmUpIHtcclxuICAgICAgICAgICAgLy8gVE9ETzog5a+56LGh5Lit55u45YWz5pWw5o2uZGlzcG9zZVxyXG4gICAgICAgICAgICBWUi5WRV9NYW5hZ2VyLmRpc3Bvc2UoKTtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coVkVfTWFuYWdlci5wcm9qZWN0cy5wcm9qZWN0cyk7XHJcbiAgICAgICAgICAgIHRoaXMuX2VuZ2luZS5kaXNwb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX2VuZ2luZSA9IG5ldyBCQUJZTE9OLkVuZ2luZSh0aGlzLl9jYW52YXMsIHRydWUpO1xyXG4gICAgICAgIFZSLkJhYnlsb25FbmdpbmUuRW5naW5lID0gdGhpcy5fZW5naW5lO1xyXG4gICAgICAgIC8vIFJlc2l6ZVxyXG4gICAgICAgIGxldCBlbmdpbmUgPSB0aGlzLl9lbmdpbmU7XHJcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBlbmdpbmUucmVzaXplKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuX3NjZW5lID0gbmV3IEJBQllMT04uU2NlbmUodGhpcy5fZW5naW5lKTtcclxuICAgICAgICBWUi5CYWJ5bG9uRW5naW5lLlNjZW5lID0gdGhpcy5fc2NlbmU7XHJcbiAgICAgICAgVlIuVGltZS5zdGFydCgpO1xyXG5cclxuICAgICAgICAvLyBUT0RPOiDorr7lrprnm7jmnLpcclxuICAgICAgICB2YXIgY2FtZXJhID0gbmV3IEJBQllMT04uQXJjUm90YXRlQ2FtZXJhKFwiTWFpbkNhbWVyYVwiLCAwLCAwLCAxMCwgbmV3IEJBQllMT04uVmVjdG9yMygwLCAwLCAwKSwgdGhpcy5fc2NlbmUpO1xyXG4gICAgICAgIGNhbWVyYS5zZXRQb3NpdGlvbihuZXcgQkFCWUxPTi5WZWN0b3IzKDIwLCAyMDAsIDQwMCkpO1xyXG4gICAgICAgIGNhbWVyYS5hdHRhY2hDb250cm9sKHRoaXMuX2NhbnZhcywgdHJ1ZSk7XHJcbiAgICAgICAgY2FtZXJhLmxvd2VyQmV0YUxpbWl0ID0gMC4xO1xyXG4gICAgICAgIGNhbWVyYS51cHBlckJldGFMaW1pdCA9IChNYXRoLlBJIC8gMikgKiAwLjk5O1xyXG4gICAgICAgIGNhbWVyYS5sb3dlclJhZGl1c0xpbWl0ID0gMTUwO1xyXG5cclxuICAgICAgICAvLyBsZXQgaW5wdXRNYXA6IHsgW2tleTogc3RyaW5nXTogYm9vbGVhbiB9ID0ge307XHJcblxyXG4gICAgICAgIC8vIFRPRE86IOWKoOi9vei/h+W6puWKqOeUu+W8gFxyXG4gICAgICAgIGVuZ2luZS5oaWRlTG9hZGluZ1VJKCk7XHJcbiAgICAgICAgLy8gZW5naW5lLmRpc3BsYXlMb2FkaW5nVUkoKTtcclxuXHJcbiAgICAgICAgLy8gVE9ETzog5Yqg6L29c2NlbmUuYmFieWxvbuWcuuaZr+aWh+S7tu+8jOW9k+WJjeS4uum7mOiupFxyXG4gICAgICAgIEJBQllMT04uU2NlbmVMb2FkZXIuQXBwZW5kKHBhdGgxLCBwYXRoMiwgdGhpcy5fc2NlbmUsIGZ1bmN0aW9uIChzY2VuZSkge1xyXG4gICAgICAgICAgICAvLyBkbyBzb21ldGhpbmcgd2l0aCB0aGUgc2NlbmVcclxuICAgICAgICAgICAgLy8g5Yqg6L296L+H5bqm5Yqo55S75YWzXHJcbiAgICAgICAgICAgIC8vIGVuZ2luZS5oaWRlTG9hZGluZ1VJKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBLZXlib2FyZCBldmVudHNcclxuICAgICAgICAgICAgLy8gdmFyIGJsdWUgPSBzY2VuZS5nZXRNZXNoQnlOYW1lKCdibHVlJykhO1xyXG5cclxuICAgICAgICAgICAgLy8gc2NlbmUuYWN0aW9uTWFuYWdlciA9IG5ldyBCQUJZTE9OLkFjdGlvbk1hbmFnZXIoc2NlbmUpO1xyXG4gICAgICAgICAgICAvLyBzY2VuZS5hY3Rpb25NYW5hZ2VyLnJlZ2lzdGVyQWN0aW9uKG5ldyBCQUJZTE9OLkV4ZWN1dGVDb2RlQWN0aW9uKEJBQllMT04uQWN0aW9uTWFuYWdlci5PbktleURvd25UcmlnZ2VyLCBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICAgICAgICAgIC8vIFx0aW5wdXRNYXBbZXZ0LnNvdXJjZUV2ZW50LmtleV0gPSBldnQuc291cmNlRXZlbnQudHlwZSA9PSBcImtleWRvd25cIjtcclxuICAgICAgICAgICAgLy8gfSkpO1xyXG4gICAgICAgICAgICAvLyBzY2VuZS5hY3Rpb25NYW5hZ2VyLnJlZ2lzdGVyQWN0aW9uKG5ldyBCQUJZTE9OLkV4ZWN1dGVDb2RlQWN0aW9uKEJBQllMT04uQWN0aW9uTWFuYWdlci5PbktleVVwVHJpZ2dlciwgZnVuY3Rpb24gKGV2dCkge1xyXG4gICAgICAgICAgICAvLyBcdGlucHV0TWFwW2V2dC5zb3VyY2VFdmVudC5rZXldID0gZXZ0LnNvdXJjZUV2ZW50LnR5cGUgPT0gXCJrZXlkb3duXCI7XHJcbiAgICAgICAgICAgIC8vIH0pKTtcclxuXHJcblxyXG4gICAgICAgICAgICAvLyAvLyBHYW1lL1JlbmRlciBsb29wXHJcbiAgICAgICAgICAgIC8vIHNjZW5lLm9uQmVmb3JlUmVuZGVyT2JzZXJ2YWJsZS5hZGQoKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgLy8gXHRpZiAoaW5wdXRNYXBbXCJ3XCJdIHx8IGlucHV0TWFwW1wiQXJyb3dVcFwiXSkge1xyXG4gICAgICAgICAgICAvLyBcdFx0Ymx1ZS5wb3NpdGlvbi56IC09IDEwMCAqIGVuZ2luZS5nZXREZWx0YVRpbWUoKSAvIDEwMDA7XHJcbiAgICAgICAgICAgIC8vIFx0fVxyXG4gICAgICAgICAgICAvLyBcdGlmIChpbnB1dE1hcFtcImFcIl0gfHwgaW5wdXRNYXBbXCJBcnJvd0xlZnRcIl0pIHtcclxuICAgICAgICAgICAgLy8gXHRcdGJsdWUucG9zaXRpb24ueCArPSAxMDAgKiBlbmdpbmUuZ2V0RGVsdGFUaW1lKCkgLyAxMDAwO1xyXG4gICAgICAgICAgICAvLyBcdH1cclxuICAgICAgICAgICAgLy8gXHRpZiAoaW5wdXRNYXBbXCJzXCJdIHx8IGlucHV0TWFwW1wiQXJyb3dEb3duXCJdKSB7XHJcbiAgICAgICAgICAgIC8vIFx0XHRibHVlLnBvc2l0aW9uLnogKz0gMTAwICogZW5naW5lLmdldERlbHRhVGltZSgpIC8gMTAwMDtcclxuICAgICAgICAgICAgLy8gXHR9XHJcbiAgICAgICAgICAgIC8vIFx0aWYgKGlucHV0TWFwW1wiZFwiXSB8fCBpbnB1dE1hcFtcIkFycm93UmlnaHRcIl0pIHtcclxuICAgICAgICAgICAgLy8gXHRcdGJsdWUucG9zaXRpb24ueCAtPSAxMDAgKiBlbmdpbmUuZ2V0RGVsdGFUaW1lKCkgLyAxMDAwO1xyXG4gICAgICAgICAgICAvLyBcdH1cclxuICAgICAgICAgICAgLy8gfSlcclxuXHJcbiAgICAgICAgICAgIC8vIC8vIHNwaGVyZVxyXG4gICAgICAgICAgICAvLyB2YXIgc3BoZXJlID0gc2NlbmUuZ2V0TWVzaEJ5TmFtZSgnc3BoZXJlJykhO1xyXG4gICAgICAgICAgICAvLyBzcGhlcmUuYWN0aW9uTWFuYWdlciA9IG5ldyBCQUJZTE9OLkFjdGlvbk1hbmFnZXIoc2NlbmUpO1xyXG5cclxuICAgICAgICAgICAgLy8gc3BoZXJlLmFjdGlvbk1hbmFnZXIucmVnaXN0ZXJBY3Rpb24obmV3IEJBQllMT04uU2V0VmFsdWVBY3Rpb24oXHJcbiAgICAgICAgICAgIC8vIFx0eyB0cmlnZ2VyOiBCQUJZTE9OLkFjdGlvbk1hbmFnZXIuT25JbnRlcnNlY3Rpb25FbnRlclRyaWdnZXIsIHBhcmFtZXRlcjogYmx1ZSB9LFxyXG4gICAgICAgICAgICAvLyBcdHNwaGVyZSwgXCJzY2FsaW5nXCIsIG5ldyBCQUJZTE9OLlZlY3RvcjMoMiwgMiwgMikpKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHNwaGVyZS5hY3Rpb25NYW5hZ2VyLnJlZ2lzdGVyQWN0aW9uKG5ldyBCQUJZTE9OLlNldFZhbHVlQWN0aW9uKFxyXG4gICAgICAgICAgICAvLyBcdHsgdHJpZ2dlcjogQkFCWUxPTi5BY3Rpb25NYW5hZ2VyLk9uSW50ZXJzZWN0aW9uRXhpdFRyaWdnZXIsIHBhcmFtZXRlcjogYmx1ZSB9XHJcbiAgICAgICAgICAgIC8vIFx0LCBzcGhlcmUsIFwic2NhbGluZ1wiLCBuZXcgQkFCWUxPTi5WZWN0b3IzKDEsIDEsIDEpKSk7XHJcblxyXG4gICAgICAgICAgICAvLyAgICAgbGV0IHAxID0gc2NlbmUuZ2V0TWVzaEJ5TmFtZSgnT2JqZWN0MDIzJyk7XHJcbiAgICAgICAgICAgIC8vICAgICBzY2VuZS5nZXRNZXNoQnlOYW1lKCdPYmplY3QwMjInKSEuc2V0UGFyZW50KHAxKTtcclxuICAgICAgICAgICAgLy8gICAgIHNjZW5lLmdldE1lc2hCeU5hbWUoJ09iamVjdDAzNScpIS5zZXRQYXJlbnQocDEpO1xyXG4gICAgICAgICAgICAvLyAgICAgbGV0IHAyID0gc2NlbmUuZ2V0TWVzaEJ5TmFtZSgnT2JqZWN0MDQyJyk7XHJcbiAgICAgICAgICAgIC8vICAgICBzY2VuZS5nZXRNZXNoQnlOYW1lKCdPYmplY3QwNDAnKSEuc2V0UGFyZW50KHAyKTtcclxuICAgICAgICAgICAgLy8gICAgIHNjZW5lLmdldE1lc2hCeU5hbWUoJ09iamVjdDA0MycpIS5zZXRQYXJlbnQocDIpO1xyXG4gICAgICAgICAgICAvLyAgICAgbGV0IHAzID0gc2NlbmUuZ2V0TWVzaEJ5TmFtZSgnT2JqZWN0MDQ3Jyk7XHJcbiAgICAgICAgICAgIC8vICAgICBzY2VuZS5nZXRNZXNoQnlOYW1lKCdPYmplY3QwNDQnKSEuc2V0UGFyZW50KHAzKTtcclxuICAgICAgICAgICAgLy8gICAgIHNjZW5lLmdldE1lc2hCeU5hbWUoJ09iamVjdDA0NScpIS5zZXRQYXJlbnQocDMpO1xyXG4gICAgICAgICAgICAvLyAgICAgbGV0IHA0ID0gc2NlbmUuZ2V0TWVzaEJ5TmFtZSgnT2JqZWN0MDUxJyk7XHJcbiAgICAgICAgICAgIC8vICAgICBzY2VuZS5nZXRNZXNoQnlOYW1lKCdPYmplY3QwNDgnKSEuc2V0UGFyZW50KHA0KTtcclxuICAgICAgICAgICAgLy8gICAgIHNjZW5lLmdldE1lc2hCeU5hbWUoJ09iamVjdDA0OScpIS5zZXRQYXJlbnQocDQpO1xyXG4gICAgICAgICAgICAvLyAgICAgcDEhLm5hbWUgPSBcIuWPtueJhzFcIjtcclxuICAgICAgICAgICAgLy8gICAgIHAyIS5uYW1lID0gXCLlj7bniYcyXCI7XHJcbiAgICAgICAgICAgIC8vICAgICBwMyEubmFtZSA9IFwi5Y+254mHM1wiO1xyXG4gICAgICAgICAgICAvLyAgICAgcDQhLm5hbWUgPSBcIuWPtueJhzRcIjtcclxuXHJcbiAgICAgICAgICAgIC8vIFRPRE86IOihqOagvOWKoOi9vea1i+ivle+8jOW6lOWcqOaJgOacieaooeWei+WKoOi9veWujOS7peWQjuWGjeWIneWni+WMluW8leaTjlxyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhob3QxLmdldERhdGEoKSk7XHJcbiAgICAgICAgICAgIGxldCBlbnRyYW5jZTogVlIuVmVyeUVuZ2luZSA9IG5ldyBWUi5WZXJ5RW5naW5lKCk7XHJcbiAgICAgICAgICAgIGxldCBwcm9qZWN0TmFtZSA9IFwi5rWL6K+V6aG555uuXCI7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGFzKTtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coYOepuuihjOaVsO+8miR7aG90MS5jb3VudEVtcHR5Um93cygpfWApO1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgZW50cmFuY2UuaW5pdChkYXRhcywgcHJvamVjdE5hbWUpO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7IC8vIFRPRE86IOWPr+iDveS8muW9seWTjeaViOeOh1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICBsZXQgb2JqZWN0czogVlIuVkVfT2JqZWN0cyA9IFZSLlZFX01hbmFnZXIub2JqZWN0cyhwcm9qZWN0TmFtZSk7XHJcbiAgICAgICAgICAgIC8vIOWFqOWxgOa4suafk+W4p+W+queOr1xyXG4gICAgICAgICAgICBzY2VuZS5vbkJlZm9yZVJlbmRlck9ic2VydmFibGUuYWRkKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIOa3u+WKoOW4p+WHveaVsFxyXG4gICAgICAgICAgICAgICAgLy8gVlIuVGltZS5fc3VtKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8g6Kem5Y+R5ZON5bqU5b6q546vXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpOiBudW1iZXIgPSAwOyBpIDwgb2JqZWN0cy5jb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IG9iamVjdElEOiBzdHJpbmcgPSBvYmplY3RzLmdldE9iamVjdElEKGkpO1xyXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdHMuZ2V0VmVyeU9iamVjdChvYmplY3RJRCkudXBkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNjZW5lLm9uS2V5Ym9hcmRPYnNlcnZhYmxlLmFkZChrYkluZm8gPT4ge1xyXG4gICAgICAgICAgICBcdGlmIChrYkluZm8udHlwZSA9PT0gQkFCWUxPTi5LZXlib2FyZEV2ZW50VHlwZXMuS0VZRE9XTikge1xyXG4gICAgICAgICAgICBcdFx0Y29uc29sZS5sb2coa2JJbmZvLmV2ZW50LmtleSk7XHJcbiAgICAgICAgICAgIFx0fVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgfSwgbnVsbCwgKHNjZW5lLCBtZXNzYWdlLCBleGNlcHRpb24pID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihleGNlcHRpb24pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLl9lbmdpbmUucnVuUmVuZGVyTG9vcCgoKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIGlmICh0aGlzLl9jYW52YXMud2lkdGggIT09IHRoaXMuX2NhbnZhcy5jbGllbnRXaWR0aCkge1xyXG4gICAgICAgICAgICAvLyAgICAgdGhpcy5fZW5naW5lLnJlc2l6ZSgpO1xyXG4gICAgICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fc2NlbmUpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zY2VuZS5hY3RpdmVDYW1lcmEpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zY2VuZS5yZW5kZXIoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gaWYgKHRoaXMuX3Nob3dGcHMpIHtcclxuICAgICAgICAgICAgLy8gXHR0aGlzLnVwZGF0ZUZwc1BvcygpO1xyXG4gICAgICAgICAgICAvLyB9XHJcblxyXG5cclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyByZXR1cm4gdGhpcztcclxuXHJcblxyXG4gICAgICAgIC8vIHRoaXMuZXhwYW5kQ29udHJvbCgpO1xyXG5cclxuXHJcbiAgICAgICAgLy8gY29uc3QgbGlnaHRQb3MgPSBuZXcgQkFCWUxPTi5WZWN0b3IzKDAsIDEsIDApO1xyXG4gICAgICAgIC8vIG5ldyBCQUJZTE9OLkhlbWlzcGhlcmljTGlnaHQoJ2hlbWxpZ2h0JywgbGlnaHRQb3MsIHRoaXMuX3NjZW5lKTtcclxuXHJcbiAgICAgICAgLy8gY29uc3Qgc3BoZXJlT3B0cyA9IHsgc2VnbWVudHM6IDE2LCBkaWFtZXRlcjogMSB9O1xyXG4gICAgICAgIC8vIGxldCBzcGhlcmUgPSBCQUJZTE9OLk1lc2hCdWlsZGVyLkNyZWF0ZVNwaGVyZShcclxuICAgICAgICAvLyBcdCdtYWluc3BoZXJlJyxcclxuICAgICAgICAvLyBcdHNwaGVyZU9wdHMsXHJcbiAgICAgICAgLy8gXHR0aGlzLl9zY2VuZVxyXG4gICAgICAgIC8vICk7XHJcbiAgICAgICAgLy8gc3BoZXJlLnBvc2l0aW9uLnkgPSAxO1xyXG5cclxuICAgICAgICAvLyBjb25zdCBncm91bmRPcHRzID0geyB3aWR0aDogNiwgaGVpZ2h0OiA2LCBzdWJkaXZpc2lvbnM6IDIgfTtcclxuICAgICAgICAvLyBCQUJZTE9OLk1lc2hCdWlsZGVyLkNyZWF0ZUdyb3VuZCgnbWFpbmdyb3VuZCcsIGdyb3VuZE9wdHMsIHRoaXMuX3NjZW5lKTtcclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG5cdC8qKlxyXG5cdCAqIOWQr+WKqOa4suafk+W+queOr++8m1xyXG5cdCAqL1xyXG4gICAgYW5pbWF0ZSgpOiBHYW1lIHtcclxuICAgICAgICB0aGlzLl9lbmdpbmUucnVuUmVuZGVyTG9vcCgoKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIGlmICh0aGlzLl9jYW52YXMud2lkdGggIT09IHRoaXMuX2NhbnZhcy5jbGllbnRXaWR0aCkge1xyXG4gICAgICAgICAgICAvLyAgICAgdGhpcy5fZW5naW5lLnJlc2l6ZSgpO1xyXG4gICAgICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fc2NlbmUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3NjZW5lLnJlbmRlcigpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fc2hvd0Zwcykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVGcHNQb3MoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG5cdC8qKlxyXG5cdCAqIOWxnuaAp+e8lui+keWZqFVJ55WM6Z2i5o6n5Yi277ybXHJcblx0ICovXHJcbiAgICB0b2dnbGVEZWJ1ZygpOiBHYW1lIHtcclxuICAgICAgICBpZiAodGhpcy5fZW5naW5lKSB7XHJcbiAgICAgICAgICAgIC8vIEFsd2F5cyBzaG93aW5nIHRoZSBkZWJ1ZyBsYXllciwgYmVjYXVzZSB5b3UgY2FuIGNsb3NlIGl0IGJ5IGl0c2VsZlxyXG4gICAgICAgICAgICB2YXIgc2NlbmUgPSB0aGlzLl9lbmdpbmUuc2NlbmVzWzBdO1xyXG4gICAgICAgICAgICBpZiAoc2NlbmUuZGVidWdMYXllci5pc1Zpc2libGUoKSkge1xyXG4gICAgICAgICAgICAgICAgc2NlbmUuZGVidWdMYXllci5oaWRlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyDmraTlpITkv67mlLnkuoZiYWJ5bG9uLmQudHPmlofku7ZcclxuICAgICAgICAgICAgICAgIHNjZW5lLmRlYnVnTGF5ZXIuc2hvdyh7IGVtYmVkTW9kZTogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcblx0LyoqXHJcblx0ICog5pu05pawZnBz5pi+56S65Y+K5pi+56S65L2N572uXHJcblx0ICovXHJcbiAgICB1cGRhdGVGcHNQb3MoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2Zwcykge1xyXG4gICAgICAgICAgICAvLyB0aGlzLl9mcHMuc3R5bGUucmlnaHQgPSBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoIC0gKHRoaXMuX3RhYmxlLmNsaWVudFdpZHRoICsgdGhpcy5fY2FudmFzLmNsaWVudFdpZHRoKSArIFwicHhcIjtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX2Zwcy5pbm5lckhUTUwgPSB0aGlzLl9lbmdpbmUuZ2V0RnBzKCkudG9GaXhlZCgpICsgXCIgZnBzXCI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsImV4cG9ydCAqIGZyb20gJy4vZ2FtZSc7XHJcbmV4cG9ydCAqIGZyb20gJy4vc2NlbmVzJzsiLCJleHBvcnQgY2xhc3MgU2NlbmVzIHtcclxuXHJcblxyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoKSB7XHJcbiAgICAvLyBjb25uZWN0IHRvIHNlcnZlclxyXG4gICAgLy8gbG9hZCBwcm9qZWN0IGRhdGFcclxuICAgIC8vIGFuYWx5c2lzIGRhdGFcclxuICAgIC8vIGxvYWQgb3JpZ2luYWwgbW9kZWxcclxuICAgIC8vIGxvYWQgc2NlbmUgb2JqZWN0IGZyb20gb3JpZ2luYWwgbW9kZWxcclxuICAgIFxyXG4gIH1cclxuXHJcblxyXG5cclxuXHJcbn0iLCJpbXBvcnQgeyBHYW1lIH0gZnJvbSBcIi4vZ2FtZVwiO1xyXG5cclxubGV0IGdhbWUhOiBHYW1lO1xyXG5sZXQgaW5pdEZsYWc6IGJvb2xlYW4gPSBmYWxzZTtcclxubGV0IGRhdGFMb2FkZWQ6IGJvb2xlYW4gPSBmYWxzZTtcclxubGV0IGRhdGFMb2FkZWQyOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG5sZXQgcGF0aDE6IHN0cmluZyA9IFwiXCI7XHJcbmxldCBwYXRoMjogc3RyaW5nID0gXCJcIjtcclxubGV0IGRhdGFzOiBhbnk7XHJcblxyXG4vKipcclxuICog5Yid5aeL5YyW5YWl5Y+j77ybXHJcbiAqL1xyXG5mdW5jdGlvbiBpbml0R2FtZSgpOiB2b2lkIHtcclxuICAgIGxldCBjYW52YXMgPSA8SFRNTENhbnZhc0VsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZW5kZXJDYW52YXNcIik7XHJcbiAgICBsZXQgZnBzTGFiZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImZwc0xhYmVsXCIpO1xyXG4gICAgaWYgKGNhbnZhcyAhPT0gbnVsbCAmJiBmcHNMYWJlbCAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdhbWUgPSBuZXcgR2FtZShjYW52YXMsIGZwc0xhYmVsKTtcclxuICAgICAgICBnYW1lLmNyZWF0ZVNjZW5lKHBhdGgxLCBwYXRoMiwgZGF0YXMpLmFuaW1hdGUoKTsgIC8vIOmTvuW8j+iwg+eUqFxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBydW5CdG4oKTogdm9pZCB7XHJcbiAgICBpZiAoZ2FtZSkge1xyXG4gICAgICAgIGdhbWUuY3JlYXRlU2NlbmUocGF0aDEsIHBhdGgyLCBkYXRhcykuYW5pbWF0ZSgpO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiB0b2dnbGVEZWJ1ZygpOiB2b2lkIHtcclxuICAgIGlmIChnYW1lKSB7XHJcbiAgICAgICAgZ2FtZS50b2dnbGVEZWJ1ZygpO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBpbml0KCk6IHZvaWQge1xyXG4gICAgLy8g562J5b6F6KGo5qC85pWw5o2u5Yqg6L295a6M5oiQXHJcbiAgICBpZiAoZGF0YUxvYWRlZCAmJiBkYXRhTG9hZGVkMikge1xyXG4gICAgICAgIGluaXRHYW1lKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHNldFRpbWVvdXQoaW5pdCwgNTAwKTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIGxvYWRTY2VuZSgpOiB2b2lkIHtcclxuXHJcbiAgICB2YXIgcHJvamVjdElEID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLnN1YnN0cmluZyg5KTtcclxuICAgIHZhciBzY2VuZURhdGE6IGFueTtcclxuICAgIGF4aW9zLnBvc3QoJy9hcGkvZ2V0U2NlbmVzJywgeyBwcm9qZWN0SUQ6IHByb2plY3RJRCB9KVxyXG4gICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICBpZiAoZGF0YS5jb2RlID09PSBcIjAwMDBcIikge1xyXG4gICAgICAgICAgICAgICAgbGV0IGxhc3RTY2VuZTogbnVtYmVyID0gZGF0YS5kYXRhLmxhc3Q7XHJcbiAgICAgICAgICAgICAgICBzY2VuZURhdGEgPSBkYXRhLmRhdGEuc2NlbmVzW2xhc3RTY2VuZV07XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzY2VuZURhdGEpO1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQudGl0bGUgPSBzY2VuZURhdGEubmFtZSArIFwiIHwg5Y+R5biD6aG555uuXCI7XHJcbiAgICAgICAgICAgICAgICBwYXRoMSA9IHNjZW5lRGF0YS5wYXRoMTtcclxuICAgICAgICAgICAgICAgIHBhdGgyID0gc2NlbmVEYXRhLnBhdGgyO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJwYXRoMTogXCIgKyBzY2VuZURhdGEucGF0aDEpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJwYXRoMjogXCIgKyBzY2VuZURhdGEucGF0aDIpO1xyXG4gICAgICAgICAgICAgICAgZGF0YUxvYWRlZDIgPSB0cnVlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGVwLmVtaXQoJ3NldHRpbmdzJywgcmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goXHJcbiAgICAgICAgICAgIGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICk7XHJcbn1cclxuXHJcbmxvYWRTY2VuZSgpO1xyXG5cclxuXHJcbmZ1bmN0aW9uIGxvYWREYXRhKCk6IHZvaWQge1xyXG4gICAgLy8g6I635Y+W6KGo5qC85pWw5o2uXHJcbiAgICB2YXIgcGF0aCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xyXG4gICAgdmFyIHBhcmFtc0RhdGE6IGFueSA9IHt9O1xyXG4gICAgcGFyYW1zRGF0YVtcIm5hbWVcIl0gPSBcIuaWsOihqOagvC50YWJsZVwiO1xyXG4gICAgYXhpb3NcclxuICAgICAgICAuZ2V0KFwiL2FwaS90YWJsZS9hY3F1aXJlXCIsIHtcclxuICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNEYXRhLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGxldCBkYXRhID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgICAgIGlmIChkYXRhLmNvZGUgPT09IFwiMDAwMFwiKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDlhYjlsIZqc29u6L2s5YyW5Li65a2X56ym5LiyXHJcbiAgICAgICAgICAgICAgICBsZXQgdGVtcERhdGEgPSBKU09OLnN0cmluZ2lmeShkYXRhLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgLy8g5a+55a2X56ym5Liy5YaN6L+b6KGM5Y+N6L2s5LmJXHJcbiAgICAgICAgICAgICAgICB0ZW1wRGF0YSA9IGVzY2FwZTJIdG1sKHRlbXBEYXRhKTtcclxuICAgICAgICAgICAgICAgIC8vIOi9rOWMluS4umpzb27lkI7vvIzotYvlgLznu5nooajmoLxcclxuICAgICAgICAgICAgICAgIC8vIGhvdDEubG9hZERhdGEoSlNPTi5wYXJzZSh0ZW1wRGF0YSkudGFibGUpO1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coSlNPTi5wYXJzZSh0ZW1wRGF0YSkudGFibGUpO1xyXG4gICAgICAgICAgICAgICAgZGF0YXMgPSBKU09OLnBhcnNlKHRlbXBEYXRhKS50YWJsZTtcclxuICAgICAgICAgICAgICAgIGRhdGFMb2FkZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gRG8gbm90aGluZ1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJsb2FkIG5vdCByaWdodDogXCIgKyBkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibG9hZCBlcnJvcjogXCIgKyBlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbn1cclxuXHJcbmxvYWREYXRhKCk7XHJcblxyXG4vL0hUTUzmoIfnrb7ovazkuYnvvIg8IC0+ICZsdDvvvIlcclxuZnVuY3Rpb24gaHRtbDJFc2NhcGUoc0h0bWw6IGFueSkge1xyXG4gICAgdmFyIHRlbXA6IGFueSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICB0ZW1wLnRleHRDb250ZW50ICE9IG51bGxcclxuICAgICAgICA/ICh0ZW1wLnRleHRDb250ZW50ID0gc0h0bWwpXHJcbiAgICAgICAgOiAodGVtcC5pbm5lclRleHQgPSBzSHRtbCk7XHJcbiAgICB2YXIgb3V0cHV0ID0gdGVtcC5pbm5lckhUTUw7XHJcbiAgICB0ZW1wID0gbnVsbDtcclxuICAgIHJldHVybiBvdXRwdXQ7XHJcbn1cclxuXHJcbi8vSFRNTOagh+etvuWPjei9rOS5ie+8iCZsdDsgLT4gPO+8iVxyXG5mdW5jdGlvbiBlc2NhcGUySHRtbChzdHI6IGFueSkge1xyXG4gICAgdmFyIHRlbXA6IGFueSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICB0ZW1wLmlubmVySFRNTCA9IHN0cjtcclxuICAgIHZhciBvdXRwdXQgPSB0ZW1wLmlubmVyVGV4dCB8fCB0ZW1wLnRleHRDb250ZW50O1xyXG4gICAgdGVtcCA9IG51bGw7XHJcbiAgICByZXR1cm4gb3V0cHV0O1xyXG59XHJcblxyXG4vLyDlhbPogZTmjInpkq5cclxuLy8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJydW5CdXR0b25cIikhLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBydW5CdG4pO1xyXG5cclxuLy8gLy8g5YWz6IGU5oyJ6ZKuXHJcbi8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZGVidWdCdXR0b25cIikhLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0b2dnbGVEZWJ1Zyk7XHJcblxyXG4vLyDlkK/liqjlvJXmk45cclxuLy8g56ys5LiA5qyh5ZCv5Yqo5pe277yM5YWI5byC5q2l5Yqg6L295pWw5o2u5ZCO5YaN5Yid5aeL5YyW77yM5ZCO5pyf5Y+v5Lul55u05o6l54K55Ye75oyJ6ZKu6L+b6KGM5Yqg6L2977ybXHJcbmluaXQoKTtcclxuLy8gbG9hZERhdGEyKClcclxuLy8gICAudGhlbihmdW5jdGlvbiAoaG90OiBIYW5kVGFibGUpIHtcclxuLy8gICAgIGNvbnNvbGUubG9nKGhvdC5nZXREYXRhKCkpO1xyXG4vLyAgIH1cclxuLy8gICApO1xyXG4iXX0="}